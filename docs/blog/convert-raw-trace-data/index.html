<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Riehl">
<meta name="author" content="Lukas Müller">
<meta name="dcterms.date" content="2023-06-14">
<meta name="description" content="An R code that converts TRACE files from FINRA into a SQLite for facilitated analysis and filtering">

<title>Convert Raw TRACE Data to a Local SQLite Database – Tidy Finance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-99a8851848bcfc05e6486f9d9e6d6ff3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DH3KZSMJ5W"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DH3KZSMJ5W', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"interstitial",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../../assets/css/global.css">
<meta property="og:title" content="Convert Raw TRACE Data to a Local SQLite Database – Tidy Finance">
<meta property="og:description" content="An R code that converts TRACE files from FINRA into a SQLite for facilitated analysis and filtering">
<meta property="og:image" content="https://www.tidy-finance.org/blog/convert-raw-trace-data/thumbnail.png">
<meta property="og:site_name" content="Tidy Finance">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="1024">
<meta property="og:image:alt" content="A 3D computer-rendered  image of a stylized bar with the name BOND on a street in the style of New York of the 1960s.">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/img/logo-website-white.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tidy Finance</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../r/index.html"> 
<span class="menu-text">R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../python/index.html"> 
<span class="menu-text">Python</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contribute.html"> 
<span class="menu-text">Contribute</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../support.html"> 
<span class="menu-text">Support</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://talks.tidy-finance.org"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../workshops/reproducible-research-workflows.html"> 
<span class="menu-text">Workshops</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Convert Raw TRACE Data to a Local SQLite Database</h1>
                  <div>
        <div class="description">
          An R code that converts TRACE files from FINRA into a SQLite for facilitated analysis and filtering
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Data</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://www.linkedin.com/in/kevin-riehl-07819a156/">Kevin Riehl</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Swiss IT Security Group AG
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://www.cofi.wi.tu-darmstadt.de/fachgebiet_cofi/team_cofi/cofi_mitarbeiter_details_96896.de.jsp">Lukas Müller</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              TU Darmstadt
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 14, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#structure-of-the-trace-data" id="toc-structure-of-the-trace-data" class="nav-link active" data-scroll-target="#structure-of-the-trace-data">Structure of the TRACE Data</a></li>
  <li><a href="#structure-of-the-local-sqlite-database" id="toc-structure-of-the-local-sqlite-database" class="nav-link" data-scroll-target="#structure-of-the-local-sqlite-database">Structure of the Local SQLite Database</a></li>
  <li><a href="#create-a-local-sqlite-from-downloaded-trace-data" id="toc-create-a-local-sqlite-from-downloaded-trace-data" class="nav-link" data-scroll-target="#create-a-local-sqlite-from-downloaded-trace-data">Create a Local SQLite from Downloaded TRACE Data</a>
  <ul class="collapse">
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final Remarks</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/tidy-finance/website/blob/main/blog/convert-raw-trace-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Corporate bond research is gaining momentum, but data availability can be a challenge for most researchers. While FINRA makes its TRACE Enhanced Data on U.S. corporate bond trading available through vendors such as Wharton Research Data Services (WRDS), not every researcher has access to these services. Alternatively, FINRA offers its Enhanced Historical Data and Academic Data (the latter exclusively) as one-off purchases. However, organizing this data can be complex and time consuming due to the nested and zipped structure of raw TXT files, making it cumbersome for researchers to explore the exciting world of fixed income securities.</p>
<p>Our R code enables you organizing the TRACE academic data and TRACE enhanced data by eliminating the complexities of multiple, nested files, simplifying the data conversion process. Drawing from the existing SAS-based solution of Dick-Nielsen (2014) <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and (2019) <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, you can now easily convert TRACE data into a single, organized SQLite database, allowing for seamless and efficient downstream analysis.</p>
<p>Here are the key benefits our solution offers:</p>
<ul>
<li><strong>Accessibility</strong>: Our solution is a cost-effective alternative to accessing data from WRDS or directly from FINRA, making it accessible to researchers without WRDS. The resulting database shares symbology with WRDS and can thus be processed with existing codes, i.e., in Tidy Finance with R.</li>
<li><strong>Efficiency</strong>: Our R code streamlines the data conversion process, saving you time and effort compared to manually structuring processing nested files.</li>
<li><strong>Versatility</strong>: SQLite is a widely used database format that can be utilized by various applications and programming languages, giving you flexibility in your downstream analysis.</li>
<li><strong>Open-Source Code</strong>: We provide our solution as R code available on <a href="https://github.com/DerKevinRiehl/bondTradingDataSqliteDbConverterR">GitHub</a>.</li>
<li><strong>TRACE academic data</strong>: TRACE academic data is only available as a one-off purchase directly from FINRA. We provide a tool to organize and process the raw data files you receive from TRACE to save you hours of work!</li>
</ul>
<p>With our R code, you can simplify your corporate bond research and overcome current limitations. Don’t let complex data organizing hold you back! Prepare yourself to be immersed in the extraordinary realm of TRACE, the key to unlock a deeper understanding of over-the-counter transactions and to unveil the mysterious pathways of fixed-income securities. With TRACE as your guide, you will embark on a journey of discovery, unraveling market trends and unearthing invaluable insights that will forever enrich your understanding of this mesmerizing world. Embrace the power of TRACE and unveil the secrets that lie within.</p>
<p>In the following, we will discuss first, the structure of the bond trading data “TRACE” provided by FINRA, second the proposed normalized database schema for the generated SQLite database, and finally third, give you a brief hands-on guide to downloading data and using our <a href="https://github.com/DerKevinRiehl/bondTradingDataSqliteDbConverterR">R code</a> to generate the SQLite.</p>
<section id="structure-of-the-trace-data" class="level1">
<h1>Structure of the TRACE Data</h1>
<p>Introducing TRACE, a powerful tool developed by FINRA to facilitate the mandatory reporting of over-the-counter transactions in eligible fixed-income securities. As a FINRA member, broker-dealers have an obligation to report transactions in TRACE-eligible securities, following <a href="https://www.finra.org/filing-reporting/trace">SEC-approved rules</a>.</p>
<p>Accessing TRACE data is a straightforward process. You can obtain it through established vendors like Wharton Research Data Services (WRDS) or purchase it directly from FINRA. The data comes in two variations: “TRACE Academic Data” and “TRACE Enhanced Historical Data,” which have minor differences while containing similar information. While the information in the data itself is virtually identical, the data sets exhibit minor differences. TRACE provides a valuable resource for understanding over-the-counter transactions and gaining insights into market trends for fixed-income securities. Explore TRACE and unlock a wealth of information that will enhance your understanding of over-the-counter transactions and the world of fixed-income securities.</p>
<p><strong>The academic data</strong> is delivered as a set of TXT files in a folder. Each TXT file follows a naming convention and represents trading bond data of a single day, e.g., <code>0047-corp-academic-trace-data-2013-01-02.txt</code>. The TXT files obtain a CSV-like table structure inside with <code>|</code> as a separator symbol, and this shows an example of the data:</p>
<pre><code>REC_CT_NB|TRD_ST_CD|ISSUE_SYM_ID|CUSIP_ID|RPTG_PARTY_ID|RPTG_PARTY_GVP_ID|PRDCT_SBTP_CD|WIS_DSTRD_CD|NO_RMNRN_CD|ENTRD_VOL_QT|RPTD_PR|YLD_DRCTN_CD|CALCD_YLD_PT|ASOF_CD|TRD_EXCTN_DT|TRD_EXCTN_TM|TRD_RPT_DT|TRD_RPT_TM|TRD_STLMT_DT|TRD_MDFR_LATE_CD|TRD_MDFR_SRO_CD|RPT_SIDE_CD|BUYER_CMSN_AMT|BUYER_CPCTY_CD|SLLR_CMSN_AMT|SLLR_CPCTY_CD|CNTRA_PARTY_ID|CNTRA_PARTY_GVP_ID|LCKD_IN_FL|ATS_FL|SPCL_PR_FL|TRDG_MKT_CD|PBLSH_FL|SYSTM_CNTRL_DT|SYSTM_CNTRL_NB|PREV_TRD_CNTRL_DT|PREV_TRD_CNTRL_NB|FIRST_TRD_CNTRL_DT|FIRST_TRD_CNTRL_NB
1|T|BCS3930817|06740L8C2|d1a9a1444e0922a25d6dc248cc687dd18bc95ea5||CORP|N||3000000.00|100.250000||7.586602||20130102|031500|20130102|080003|20130107|||S|0.00||0.00|A|C|||||S1|Y|20130102|2000000003|||20130102|2000000003
2|T|BCS3930817|06740L8C2|d1a9a1444e0922a25d6dc248cc687dd18bc95ea5||CORP|N||3000000.00|100.250000||7.586602||20130102|031500|20130102|080003|20130107|||B|0.00|A|0.00||C|||||S1|Y|20130102|2000000004|||20130102|2000000004
...</code></pre>
<p><strong>The enhanced data</strong> is delivered as a set of ZIP files in a folder representing a year like <code>EHDwC 2020.zip</code>. Each of these ZIP files contains further sub-ZIP files representing single days like <code>enhanced-time-and-sales-cusip-2020-01-02.zip</code>. Finally, in these sub-ZIP files, you can find TXT files representing the trading bond data of a specific day, like <code>enhanced-time-and-sales-cusip-2020-01-02.txt</code>.</p>
<pre><code>├── EHDwC 2020.zip
│   └──enhanced-time-and-sales-cusip-2020-01-02.zip
│   |  └── enhanced-time-and-sales-cusip-2020-01-02.txt
│   └──enhanced-time-and-sales-cusip-2020-01-03.zip
│      └── enhanced-time-and-sales-cusip-2020-01-03.txt
...</code></pre>
<p>The TXT files obtain a CSV-like table structure inside with <code>|</code> as a separator symbol, this shows an example of the data:</p>
<pre><code>Record Count Num|Reference Number|Trade Status|TRACE Symbol|CUSIP|Bloomberg Identifier|Sub Product|When Issued Indicator|Remuneration|Quantity|Price|Yield Direction|Yield|As Of Indicator|Execution Date|Execution Time|Trade Report Date|Trade Report Time|Settlement Date|Trade Modifier 3|Trade Modifier 4|Buy/Sell Indicator|Buyer Commission|Buyer Capacity|Seller Commission|Seller Capacity|Reporting Party Type|Contra Party Indicator|Locked In Indicator|ATS Indicator|Special Price Indicator|Trading Market Indicator|Dissemination Flag|Prior Trade Report Date|Prior Reference Number|First Trade Control Date|First Trade Control Number
1|0000005|T|SUHJ4887191|G857ABAC4|BBG00GQ7JTK4|CORP|N||350000.00|99.970000|||A|20200101|205505|20200102|080002|20200106|||B|0.00|P|0.00||D|C||||S1|Y|||20200102|0000005
2|0000006|T|SUHJ4887191|G857ABAC4|BBG00GQ7JTK4|CORP|N||350000.00|100.000000|||A|20200101|205505|20200102|080002|20200106|||S|0.00||0.00|P|D|D||||S1|Y|||20200102|0000006
...</code></pre>
<p><strong>The comparison</strong> of the columns and column names of academic and enhanced data in <a href="#tbl-comparison" class="quarto-xref">Table&nbsp;1</a> reveals that they are not identical but resemble strongly.</p>
<div class="table-wrapper" data-markdown="block">
<div id="tbl-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Comparison of table structure between academic and enhanced TRACE.
</figcaption>
<div aria-describedby="tbl-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 2%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Academic Data</strong></th>
<th></th>
<th></th>
<th></th>
<th><strong>Enhanced Data</strong></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Nr</strong></td>
<td><strong>Field Name</strong></td>
<td><strong>Example</strong></td>
<td></td>
<td><strong>Nr</strong></td>
<td><strong>Field Name</strong></td>
<td><strong>Example</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>REC_CT_NB</td>
<td>1</td>
<td></td>
<td>1</td>
<td>Record.Count.Num</td>
<td>1</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>2</td>
<td>Reference.Number</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>TRD_ST_CD</td>
<td>T</td>
<td></td>
<td>3</td>
<td>Trade.Status</td>
<td>T</td>
</tr>
<tr class="odd">
<td>3</td>
<td>ISSUE_SYM_ID</td>
<td>BCS4940817</td>
<td></td>
<td>4</td>
<td>TRACE.Symbol</td>
<td>CAT6354537</td>
</tr>
<tr class="even">
<td>4</td>
<td>CUSIP_ID</td>
<td>06743L8C2</td>
<td></td>
<td>5</td>
<td>CUSIP</td>
<td>14954R2P1</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>6</td>
<td>Bloomberg.Identifier</td>
<td>BBG032F5NQR4</td>
</tr>
<tr class="even">
<td>5</td>
<td>RPTG_PARTY_ID</td>
<td>d1b2a1444e0…</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>6</td>
<td>RPTG_PARTY_GVP_ID</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>7</td>
<td>PRDCT_SBTP_CD</td>
<td>CORP</td>
<td></td>
<td>7</td>
<td>Sub.Product</td>
<td>CORP</td>
</tr>
<tr class="odd">
<td>8</td>
<td>WIS_DSTRD_CD</td>
<td>N</td>
<td></td>
<td>8</td>
<td>When.Issued.Indicator</td>
<td>N</td>
</tr>
<tr class="even">
<td>9</td>
<td>NO_RMNRN_CD</td>
<td></td>
<td></td>
<td>9</td>
<td>Remuneration</td>
<td></td>
</tr>
<tr class="odd">
<td>10</td>
<td>ENTRD_VOL_QT</td>
<td>3000000</td>
<td></td>
<td>10</td>
<td>Quantity</td>
<td>25000,00</td>
</tr>
<tr class="even">
<td>11</td>
<td>RPTD_PR</td>
<td>100.25</td>
<td></td>
<td>11</td>
<td>Price</td>
<td>95,407,000</td>
</tr>
<tr class="odd">
<td>12</td>
<td>YLD_DRCTN_CD</td>
<td></td>
<td></td>
<td>12</td>
<td>Yield.Direction</td>
<td></td>
</tr>
<tr class="even">
<td>13</td>
<td>CALCD_YLD_PT</td>
<td>7.586602</td>
<td></td>
<td>13</td>
<td>Yield</td>
<td>2,554,416</td>
</tr>
<tr class="odd">
<td>14</td>
<td>ASOF_CD</td>
<td></td>
<td></td>
<td>14</td>
<td>As.Of.Indicator</td>
<td></td>
</tr>
<tr class="even">
<td>15</td>
<td>TRD_EXCTN_DT</td>
<td>20130102</td>
<td></td>
<td>15</td>
<td>Execution.Date</td>
<td>20220401</td>
</tr>
<tr class="odd">
<td>16</td>
<td>TRD_EXCTN_TM</td>
<td>31500</td>
<td></td>
<td>16</td>
<td>Execution.Time</td>
<td>80002</td>
</tr>
<tr class="even">
<td>17</td>
<td>TRD_RPT_DT</td>
<td>20130102</td>
<td></td>
<td>17</td>
<td>Trade.Report.Date</td>
<td>20220401</td>
</tr>
<tr class="odd">
<td>18</td>
<td>TRD_RPT_TM</td>
<td>80003</td>
<td></td>
<td>18</td>
<td>Trade.Report.Time</td>
<td>80002</td>
</tr>
<tr class="even">
<td>19</td>
<td>TRD_STLMT_DT</td>
<td>20130107</td>
<td></td>
<td>19</td>
<td>Settlement.Date</td>
<td>20220405</td>
</tr>
<tr class="odd">
<td>20</td>
<td>TRD_MDFR_LATE_CD</td>
<td></td>
<td></td>
<td>20</td>
<td>Trade.Modifier.3</td>
<td></td>
</tr>
<tr class="even">
<td>21</td>
<td>TRD_MDFR_SRO_CD</td>
<td></td>
<td></td>
<td>21</td>
<td>Trade.Modifier.4</td>
<td></td>
</tr>
<tr class="odd">
<td>22</td>
<td>RPT_SIDE_CD</td>
<td>S</td>
<td></td>
<td>22</td>
<td>Buy.Sell.Indicator</td>
<td>B</td>
</tr>
<tr class="even">
<td>23</td>
<td>BUYER_CMSN_AMT</td>
<td>0</td>
<td></td>
<td>23</td>
<td>Buyer.Commission</td>
<td>0,00</td>
</tr>
<tr class="odd">
<td>24</td>
<td>BUYER_CPCTY_CD</td>
<td></td>
<td></td>
<td>24</td>
<td>Buyer.Capacity</td>
<td>A</td>
</tr>
<tr class="even">
<td>25</td>
<td>SLLR_CMSN_AMT</td>
<td>0</td>
<td></td>
<td>25</td>
<td>Seller.Commission</td>
<td>0,00</td>
</tr>
<tr class="odd">
<td>26</td>
<td>SLLR_CPCTY_CD</td>
<td>A</td>
<td></td>
<td>26</td>
<td>Seller.Capacity</td>
<td></td>
</tr>
<tr class="even">
<td>27</td>
<td>CNTRA_PARTY_ID</td>
<td>C</td>
<td></td>
<td>27</td>
<td>Reporting.Party.Type</td>
<td>D</td>
</tr>
<tr class="odd">
<td>28</td>
<td>CNTRA_PARTY_GVP_ID</td>
<td></td>
<td></td>
<td>28</td>
<td>Contra.Party.Indicator</td>
<td>D</td>
</tr>
<tr class="even">
<td>29</td>
<td>LCKD_IN_FL</td>
<td></td>
<td></td>
<td>29</td>
<td>Locked.In.Indicator</td>
<td></td>
</tr>
<tr class="odd">
<td>30</td>
<td>ATS_FL</td>
<td></td>
<td></td>
<td>30</td>
<td>ATS.Indicator</td>
<td></td>
</tr>
<tr class="even">
<td>31</td>
<td>SPCL_PR_FL</td>
<td></td>
<td></td>
<td>31</td>
<td>Special.Price.Indicator</td>
<td></td>
</tr>
<tr class="odd">
<td>32</td>
<td>TRDG_MKT_CD</td>
<td>S1</td>
<td></td>
<td>32</td>
<td>Trading.Market.Indicator</td>
<td>S1</td>
</tr>
<tr class="even">
<td>33</td>
<td>PBLSH_FL</td>
<td>Y</td>
<td></td>
<td>33</td>
<td>Dissemination.Flag</td>
<td>N</td>
</tr>
<tr class="odd">
<td>34</td>
<td>SYSTM_CNTRL_DT</td>
<td>20130102</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>35</td>
<td>SYSTM_CNTRL_NB</td>
<td>2000000003</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>36</td>
<td>PREV_TRD_CNTRL_DT</td>
<td></td>
<td></td>
<td>34</td>
<td>Prior.Trade.Report.Date</td>
<td>NA</td>
</tr>
<tr class="even">
<td>37</td>
<td>PREV_TRD_CNTRL_NB</td>
<td></td>
<td></td>
<td>35</td>
<td>Prior.Reference.Number</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>38</td>
<td>FIRST_TRD_CNTRL_DT</td>
<td>20130102</td>
<td></td>
<td>36</td>
<td>First.Trade.Control.Date</td>
<td>20220401</td>
</tr>
<tr class="even">
<td>39</td>
<td>FIRST_TRD_CNTRL_NB</td>
<td>2000000003</td>
<td></td>
<td>37</td>
<td>First.Trade.Control.Number</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
<section id="structure-of-the-local-sqlite-database" class="level1">
<h1>Structure of the Local SQLite Database</h1>
<p>In order to work with a merged set of final data, we propose an unified schema for the data, which is oriented on the academic data. The resulting SQLite represents the data in a standardized and normalized form that can be used for further analysis with simple SQL queries in a variety of applications and programming languages. The resulting database shares template and labeling with WRDS and can therefore seamlessly interface with existing program codes for cleaning the data, e.g., as given in Tidy Finance with R (https://gist.github.com/patrick-weiss/3a05b3ab281563b2e94858451c2eb3a4).</p>
<p><a href="#tbl-finaltable" class="quarto-xref">Table&nbsp;2</a> explains the fields of the final table. Capitalized columns are carried over from the original data, and lowercase columns denote variables used in the code available through the functions used to clean and process the data.</p>
<div id="tbl-finaltable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-finaltable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Structure of the local SQLite database.
</figcaption>
<div aria-describedby="tbl-finaltable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 29%">
<col style="width: 31%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Final Data</strong></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Nr</strong></td>
<td><strong>Field Name</strong></td>
<td><strong>SQLite Datatype</strong></td>
<td><strong>Example</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>REC_CT_NB</td>
<td>INTEGER</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>REF_NB</td>
<td>INTEGER</td>
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
<td>trc_st</td>
<td>TEXT</td>
<td>T</td>
</tr>
<tr class="odd">
<td>4</td>
<td>ISSUE_SYM_ID</td>
<td>TEXT</td>
<td>CAT5654597</td>
</tr>
<tr class="even">
<td>5</td>
<td>cusip_id</td>
<td>TEXT</td>
<td>14943R2P1</td>
</tr>
<tr class="odd">
<td>6</td>
<td>BLMBRG_ID</td>
<td>TEXT</td>
<td>BBG012F8NQR4</td>
</tr>
<tr class="even">
<td>7</td>
<td>RPTG_PARTY_ID</td>
<td>TEXT</td>
<td>d1a3a1444e..</td>
</tr>
<tr class="odd">
<td>8</td>
<td>RPTG_PARTY_GVP_ID</td>
<td>TEXT</td>
<td>12345</td>
</tr>
<tr class="even">
<td>9</td>
<td>PRDCT_SBTP_CD</td>
<td>TEXT</td>
<td>CORP</td>
</tr>
<tr class="odd">
<td>10</td>
<td>wis_fl</td>
<td>TEXT</td>
<td>N</td>
</tr>
<tr class="even">
<td>11</td>
<td>NO_RMNRN_CD</td>
<td>TEXT</td>
<td>12345</td>
</tr>
<tr class="odd">
<td>12</td>
<td>entrd_vol_qt</td>
<td>INTEGER</td>
<td>3000000</td>
</tr>
<tr class="even">
<td>13</td>
<td>rptd_pr</td>
<td>REAL</td>
<td>100.25</td>
</tr>
<tr class="odd">
<td>14</td>
<td>YLD_DRCTN_CD</td>
<td>TEXT</td>
<td>12345</td>
</tr>
<tr class="even">
<td>15</td>
<td>yld_pt</td>
<td>REAL</td>
<td>7.586602</td>
</tr>
<tr class="odd">
<td>16</td>
<td>asof_cd</td>
<td>TEXT</td>
<td>12345</td>
</tr>
<tr class="even">
<td>17</td>
<td>trd_exctn_dt</td>
<td>TEXT</td>
<td>20220401</td>
</tr>
<tr class="odd">
<td>18</td>
<td>trd_exctn_tm</td>
<td>TEXT</td>
<td>80002</td>
</tr>
<tr class="even">
<td>19</td>
<td>trd_rpt_dt</td>
<td>TEXT</td>
<td>20220401</td>
</tr>
<tr class="odd">
<td>20</td>
<td>trd_rpt_tm</td>
<td>TEXT</td>
<td>80002</td>
</tr>
<tr class="even">
<td>21</td>
<td>stlmnt_dt</td>
<td>TEXT</td>
<td>20220405</td>
</tr>
<tr class="odd">
<td>22</td>
<td>TRD_MDFR_LATE_CD</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="even">
<td>23</td>
<td>TRD_MDFR_SRO_CD</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="odd">
<td>24</td>
<td>rpt_side_cd</td>
<td>TEXT</td>
<td>B</td>
</tr>
<tr class="even">
<td>25</td>
<td>BUYER_CMSN_AMT</td>
<td>REAL</td>
<td>10.00</td>
</tr>
<tr class="odd">
<td>26</td>
<td>BUYER_CPCTY_CD</td>
<td>TEXT</td>
<td>A</td>
</tr>
<tr class="even">
<td>27</td>
<td>SLLR_CMSN_AMT</td>
<td>REAL</td>
<td>12.00</td>
</tr>
<tr class="odd">
<td>28</td>
<td>SLLR_CPCTY_CD</td>
<td>TEXT</td>
<td>12345</td>
</tr>
<tr class="even">
<td>29</td>
<td>RPT_PRTY_ID</td>
<td>TEXT</td>
<td>D</td>
</tr>
<tr class="odd">
<td>30</td>
<td>cntra_mp_id</td>
<td>TEXT</td>
<td>D</td>
</tr>
<tr class="even">
<td>31</td>
<td>CNTRA_PARTY_GVP_ID</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="odd">
<td>32</td>
<td>LCKD_IN_FL</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="even">
<td>33</td>
<td>ATS_FL</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="odd">
<td>34</td>
<td>spcl_trd_fl</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="even">
<td>35</td>
<td>TRDG_MKT_CD</td>
<td>TEXT</td>
<td>S1</td>
</tr>
<tr class="odd">
<td>36</td>
<td>PBLSH_FL</td>
<td>TEXT</td>
<td>N</td>
</tr>
<tr class="even">
<td>37</td>
<td>SYSTM_CNTRL_DT</td>
<td>TEXT</td>
<td>20130102</td>
</tr>
<tr class="odd">
<td>38</td>
<td>SYSTM_CNTRL_NB</td>
<td>TEXT</td>
<td>2000000003</td>
</tr>
<tr class="even">
<td>39</td>
<td>pr_trd_dt</td>
<td>TEXT</td>
<td>20130103</td>
</tr>
<tr class="odd">
<td>40</td>
<td>PREV_TRD_CNTRL_NB</td>
<td>TEXT</td>
<td></td>
</tr>
<tr class="even">
<td>41</td>
<td>FIRST_TRD_CNTRL_DT</td>
<td>TEXT</td>
<td>20130105</td>
</tr>
<tr class="odd">
<td>42</td>
<td>FIRST_TRD_CNTRL_NB</td>
<td>INTEGER</td>
<td>2</td>
</tr>
<tr class="even">
<td>43</td>
<td>msg_seq_nb</td>
<td>TEXT</td>
<td>AC_2000000003</td>
</tr>
<tr class="odd">
<td>44</td>
<td>orig_msg_seq_nb</td>
<td>TEXT</td>
<td>AC_2</td>
</tr>
<tr class="even">
<td>45</td>
<td>days_to_sttl_ct</td>
<td>INTEGER</td>
<td>4 (days between stlmnt_dt and trd_exectn_dt)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="create-a-local-sqlite-from-downloaded-trace-data" class="level1">
<h1>Create a Local SQLite from Downloaded TRACE Data</h1>
<p>After successfully ordering and downloading the data, you should possess all necessary raw files to start creating a SQLite. In the following, we assume that you possess a folder with all downloaded TRACE data (enhanced and academic) called “TRACE_Downloads”, with a similar structure as follows:</p>
<pre><code>TRACE_Downloads/
├── academic_txts/
│   ├── 0047-corp-academic-trace-data-2013-01-02.txt
│   ├── 0047-corp-academic-trace-data-2013-01-03.txt
│   └──...
├── EHDwC 2020.zip
├── EHDwC 2021.zip
├── EHDwC 2022.zip
├── ...</code></pre>
<p>The below R code allows the user to convert the raw data provided by FINRA (Academic Data as well as Enhanced Historical Data) into a SQLite for further analyses. For the curious reader, you can find implementation details and code documentation in our <a href="https://github.com/DerKevinRiehl/bondTradingDataSqliteDbConverterR">GitHub Repository</a>.</p>
<p><strong>Please note</strong>, that the conversion can take some time and might require disk space (in our case for data around 2013 to 2022 around 4 days and 50 GB on a normal machine).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Start Connection To SQLite File</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>database_file <span class="ot">&lt;-</span> (<span class="st">"bond_trading_data_db.sqlite"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), database_file)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"SQL connection established..."</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create table schema in SQLite</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">prepare_database_table</span>(conn)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Created table schema..."</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Convert downloaded academic data and insert to SQLite</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Start convert download academic data in final table..."</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>folder_A <span class="ot">&lt;-</span> (<span class="st">"academic_txts"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_downloaded_academic_data_to_sqlite_db</span>(conn, folder_A)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Convert downloaded enhanced data and insert to SQLite</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Start convert download enhanced data in final table..."</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_downloaded_enhanced_data_to_sqlite_db</span>(conn, <span class="st">"EHDwC 2020.zip"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_downloaded_enhanced_data_to_sqlite_db</span>(conn, <span class="st">"EHDwC 2021.zip"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_downloaded_enhanced_data_to_sqlite_db</span>(conn, <span class="st">"EHDwC 2022.zip"</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Close Connection to SQLite File</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(conn)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Connection closed and database successfully created..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks">Final Remarks</h2>
<p>We hope that this blog post is helpful to the reader working with TRACE academic data and TRACE enhanced data and in facilitating analyses in this emerging, exciting, and promising field of research.</p>
<p>At the end, we would like to thank the editors of Tidy Finance for their helpful suggestions and support with writing this blog post, and our supervisor Prof.&nbsp;Dr.&nbsp;Dirk Schiereck from the <a href="https://www.cofi.wi.tu-darmstadt.de/index.en.jsp">Chair of Corporate Finance at TU Darmstadt (Germany)</a> who made the data available for this project.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Dick-Nielsen, J. (2014). How to clean enhanced TRACE data. Available at [SSRN 2337908] (https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2337908).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Dick-Nielsen, J., &amp; Poulsen, T. K. (2019). How to clean academic trace data. Available at [SSRN 3456082] (https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3456082).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<div class="custom-footer">
  <div class="copyright">© Christoph Frey, Christoph Scheuch, Stefan Voigt &amp; Patrick Weiss</div>
  <a href="disclaimer.html">Disclaimer</a>
  <a href="#" id="open_preferences_center">Cookie Preferences</a>
</div>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.tidy-finance\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/tidy-finance/website/blob/main/blog/convert-raw-trace-data/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>