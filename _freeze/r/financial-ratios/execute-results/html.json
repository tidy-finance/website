{
  "hash": "4cf3e31894787f5ca7ac4bafc8ed4199",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Financial Ratios\nmetadata:\n  pagetitle: Financial Ratios with R\n  description-meta: Learn how to use the programming language R to analyze companies using financial ratios.\ncache: true\n---\n\n\n\n\nIn this chapter, we explore the role of financial statements and financial ratios in analyzing companies. Financial statements are essential because they serve as a standardized source of information, providing a consistent framework that enables investors, creditors, and analysts to assess a company’s financial health and performance. All companies are legally required to file financial statements, which adds a layer of accountability and reliability to the information they disclose. Public companies, in particular, are subject to even more rigorous standards: they must have their financial statements independently audited, which helps ensure accuracy and integrity in reporting. Additionally, in the United States, public companies are required by the Securities and Exchange Commission, or SEC, to file their financials quarterly and annually. This requirement ensures that investors and analysts have timely information, allowing them to make informed decisions throughout the year.\n\nFinancial ratios are tools for understanding a company’s financial health and performance. They facilitate:\n\n- Benchmarking: By comparing ratios across different companies, investors and analysts can assess how a company stands relative to its peers within the same industry.\n-\tTrend Analysis: Evaluating a company’s financial ratios over multiple periods reveals trends and patterns, offering insights into its financial trajectory and operational effectiveness.\n-\tPortfolio Selection: Investors often use financial ratios to screen and select high-quality firms for their portfolios. \n-\tAsset Pricing Models: Financial ratios are integral to factor models in asset pricing, such as the Fama-French three-factor model or Q-factors)\n-\tCapital Structure and Risk Management: Ratios aid in assessing its risk profile and predicting potential financial distress. \n\nThis chapter is based on the following packages: \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidyfinance)\nlibrary(scales)\nlibrary(ggrepel)\nlibrary(fmpapi)\n```\n:::\n\n\n\n\n## Balance Sheet Statements\n\nThe balance sheet provides a snapshot of a company's financial standing at a specific point in time. It shows the company’s assets, liabilities, and shareholders’ equity, according to the fundamental accounting equation: \n\n$$\\text{Assets} = \\text{Liabilities} + \\text{Shareholders’ Equity}$$\n\nAssets are the resources owned by the company that are expected to provide future economic benefits, liabilities are obligations the company owes to external parties, and shareholders’ equity is the residual interest in the assets of the company after deducting liabilities. @fig-400 shows a stylized balance sheet with these components.\n\n![A stylized representation of a balance sheet statement.](../assets/img/balance-sheet.svg){#fig-400 alt=\"A stylized representation of a balance sheet statement.\"}\n\nLet us dive deeper into the asset side which typically comprises of the following parts: current assets that are expected to be converted into cash or used up within one year, such as cash, accounts receivable (=money owed to a business for goods or services), and inventory, non-current assets, which are long-term investments and property, plant, and equipment (PP&E) that are not expected to be liquidated within a year, and intangible assets, which are non-physical asset such as a patent, brand, trademark, or copyright. @fig-401 shows a stylized breakdown of the asset side. \n \n![A stylized representation of a breakdown of assets on a balance sheet.](../assets/img/assets.svg){#fig-401 alt=\"A stylized representation of a breakdown of assets on a balance sheet.\"}\n\nLiabilities are typically split into current liabilities, which are debts or obligations due within one year, including accounts payable and short-term loans, and non-current liabilities, which are long-term debts and obligations due beyond one year, such as long-term debt or deferred taxes. @fig-402 illustrates this breakdown in liabilities. \n\n![A stylized representation of a breakdown of liabilities on a balance sheet.](../assets/img/liabilities.svg){#fig-402 alt=\"A stylized representation of a breakdown of liabilities on a balance sheet.\"}\n\nLastly, equity is typically divided into retained earnings, which are accumulated profits that have been reinvested in the business rather than distributed as dividends, common stock, which is capital contributed by shareholders, and preferred stock, which is a different type of equity that represents ownership of a company and the right to claim income from the company’s operations, but with limited voting rights. @fig-403 shows the corresponding equity breakdown.\n\n![A stylized representation of a breakdown of equity on a balance sheet.](../assets/img/equity.svg){#fig-403 alt=\"A stylized representation of a breakdown of equity on a balance sheet.\"}\n\n@fig-404 shows an example balance sheet from Microsoft in 2023. \n\n![A screenshot of the balance sheet statement of Microsoft in 2023.](../assets/img/balance-sheet-msft.png){#fig-404 alt=\"A screenshot of the balance sheet statement of Microsoft in 2023.\"}\n\nWe can use the `fmpapi` package to download financial statements:\n\n- SEC provides interface to [search filings](https://www.sec.gov/search-filings)\n- [Financial Modeling Prep (FMP) API](https://site.financialmodelingprep.com/developer/docs) provides programming interface\n- Free tier: 250 calls / day, 5 year historical fundamental data\n- R package: [tidy-finance/r-fmpapi](https://github.com/tidy-finance/r-fmpapi)\n- Install via `install.packages(\"fmpapi\")`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfmp_get(\n  resource = \"balance-sheet-statement\", \n  symbol = \"MSFT\", \n  params = list(period = \"annual\", limit = 5)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 54\n  date       symbol reported_currency cik        filling_date\n  <date>     <chr>  <chr>             <chr>      <date>      \n1 2024-06-30 MSFT   USD               0000789019 2024-07-30  \n2 2023-06-30 MSFT   USD               0000789019 2023-07-27  \n3 2022-06-30 MSFT   USD               0000789019 2022-07-28  \n4 2021-06-30 MSFT   USD               0000789019 2021-07-29  \n5 2020-06-30 MSFT   USD               0000789019 2020-07-30  \n# ℹ 49 more variables: accepted_date <dttm>, calendar_year <int>,\n#   period <chr>, cash_and_cash_equivalents <dbl>,\n#   short_term_investments <dbl>,\n#   cash_and_short_term_investments <dbl>, net_receivables <dbl>,\n#   inventory <dbl>, other_current_assets <dbl>,\n#   total_current_assets <dbl>, property_plant_equipment_net <dbl>,\n#   goodwill <dbl>, intangible_assets <dbl>, …\n```\n\n\n:::\n:::\n\n\n\n\n## Income Statements\n\nIncome statements show a company’s financial performance over a quarter or year by detailing revenue, costs, and profits. It's main components are:\n\n- Revenue (Sales): the total income generated from goods or services sold.\n- Cost of Goods Sold (COGS): direct costs associated with producing the goods or services (raw materials, labor, etc.).\n- Gross Profit: revenue minus COGS, showing the basic profitability from core operations.\n- Operating Expenses: costs related to regular business operations (Salaries, Rent, Marketing).\n- Operating Income (EBIT): earnings before interest and taxes (measures profitability from core operations before financing and tax costs).\n- Net Income: The “bottom line”—total profit after all expenses, taxes, and interest are subtracted from revenue.\n\n@fig-405 provides a stylized representation of these components. Income statements are key in analyizing profitability, operational efficiency, and cost management of a company.\n\n![A stylized representation of an income statement.](../assets/img/income-statements.svg){#fig-405 alt=\"A stylized representation of an income statement.\"}\n\n@fig-406 shows an example income statements of Microsoft 2023.\n\n![A screenshot of the income statement of Microsoft in 2023.](../assets/img/income-statements-msft.png){#fig-406 alt=\"A screenshot of the income statement of Microsoft in 2023.\"}\n\nDownload income statements data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfmp_get(\n  resource = \"income-statement\", \n  symbol = \"MSFT\", \n  params = list(period = \"annual\", limit = 5)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 38\n  date       symbol reported_currency cik        filling_date\n  <date>     <chr>  <chr>             <chr>      <date>      \n1 2024-06-30 MSFT   USD               0000789019 2024-07-30  \n2 2023-06-30 MSFT   USD               0000789019 2023-07-27  \n3 2022-06-30 MSFT   USD               0000789019 2022-07-28  \n4 2021-06-30 MSFT   USD               0000789019 2021-07-29  \n5 2020-06-30 MSFT   USD               0000789019 2020-07-30  \n# ℹ 33 more variables: accepted_date <dttm>, calendar_year <int>,\n#   period <chr>, revenue <dbl>, cost_of_revenue <dbl>,\n#   gross_profit <dbl>, gross_profit_ratio <dbl>,\n#   research_and_development_expenses <dbl>,\n#   general_and_administrative_expenses <dbl>,\n#   selling_and_marketing_expenses <dbl>,\n#   selling_general_and_administrative_expenses <dbl>, …\n```\n\n\n:::\n:::\n\n\n\n\n## Cash Flow Statements\n\nCash flow statements provide details about the flow of cash in and out of the business during a quarter or year, categorized into operating, investing, and financing activities. Overall, they show a company’s ability to generate cash to fund operations and growth.\n\n- Operating Activities: cash generated from a company’s core business activities (Net Income adjusted for non-cash items like depreciation, and changes in working capital).\n- Financing Activities: cash flows related to borrowing, repaying debt, issuing equity, or paying dividends.\n- Investing Activities: cash spent on or received from long-term investments, such as purchasing or selling property, equipment, or securities.\n\n@fig-407 shows a stylized cash flow statement. \n\n![A stylized representation of a cash flow statement.](../assets/img/cash-flow-statements.svg){#fig-407 alt=\"A stylized representation of a cash flow statement.\"}\n\n@fig-408 shows example cash flow statements of Microsoft 2023.\n\n![A screenshot of the cash flow statement of Microsoft in 2023.](../assets/img/cash-flow-statements-msft.png){#fig-408 alt=\"A screenshot of the cash flow statement of Microsoft in 2023.\"}\n\nDownload cash flow statements data for Microsoft:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfmp_get(\n  resource = \"cash-flow-statement\", \n  symbol = \"MSFT\", \n  params = list(period = \"annual\", limit = 5)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 40\n  date       symbol reported_currency cik        filling_date\n  <date>     <chr>  <chr>             <chr>      <date>      \n1 2024-06-30 MSFT   USD               0000789019 2024-07-30  \n2 2023-06-30 MSFT   USD               0000789019 2023-07-27  \n3 2022-06-30 MSFT   USD               0000789019 2022-07-28  \n4 2021-06-30 MSFT   USD               0000789019 2021-07-29  \n5 2020-06-30 MSFT   USD               0000789019 2020-07-30  \n# ℹ 35 more variables: accepted_date <dttm>, calendar_year <int>,\n#   period <chr>, net_income <dbl>,\n#   depreciation_and_amortization <dbl>, deferred_income_tax <dbl>,\n#   stock_based_compensation <dbl>, change_in_working_capital <dbl>,\n#   accounts_receivables <dbl>, inventory <int>,\n#   accounts_payables <dbl>, other_working_capital <dbl>,\n#   other_non_cash_items <int>, …\n```\n\n\n:::\n:::\n\n\n\n\n## Download Financial Statements\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconstituents <- download_data_constituents(\"Dow Jones Industrial Average\") |> \n  pull(symbol)\n\nparams <- list(period = \"annual\", limit = 5)\n\nbalance_sheet_statements <- constituents |> \n  map_df(\n    \\(x) fmp_get(resource = \"balance-sheet-statement\", symbol = x, params = params)\n  )\n\nincome_statements <- constituents |> \n  map_df(\n    \\(x) fmp_get(resource = \"income-statement\", symbol = x, params = params)\n  )\n\ncash_flow_statements <- constituents |> \n  map_df(\n    \\(x) fmp_get(resource = \"cash-flow-statement\", symbol = x, params = params)\n  )\n```\n:::\n\n\n\n\n## Liquidity Ratios\n\nWe start with ratios that aim to assess a company's liquidity using items from balance sheet statements. The Current Ratio measures a company's ability to pay off its short-term liabilities with its short-term assets. A ratio above 1 indicates that the company has more current assets than current liabilities, suggesting good short-term financial health. \n\n$$\\text{Current Ratio} = \\frac{\\text{Current Assets}}{\\text{Total Assets}}$$\n\nThe next ratio is the Quick Ratio, which measures a company's ability to meet its short-term obligations without relying on the sale of inventory. A ratio above 1 here indicates that the company can cover its short-term liabilities with its most liquid assets. \n\n$$\\text{Quick Ratio} = \\frac{\\text{Current Assets - Liabilities}}{\\text{Current Liabilities}}$$\nLastly, the Cash Ratio measures a company's ability to pay off its short-term liabilities with its cash and cash equivalents. A ratio of 1 or higher indicates a strong liquidity position. \n\n$$\\text{Cash Ratio} = \\frac{\\text{Cash and Cash Equivalents}}{\\text{Current Liabilities}}$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselected_symbols <- c(\"MSFT\", \"AAPL\", \"AMZN\")\n\nbalance_sheets_statements <- balance_sheet_statements |> \n  mutate(\n    current_ratio = total_current_assets / total_assets,\n    quick_ratio = (total_current_assets - total_liabilities) / total_current_liabilities,\n    cash_ratio = cash_and_cash_equivalents / total_current_liabilities,\n    label = if_else(symbol %in% selected_symbols, symbol, NA),\n  )\n```\n:::\n\n\n\n\nComparing liquidity ratios @fig-409 shows...\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_liquidity_ratios <- balance_sheets_statements |> \n  filter(calendar_year == 2023 & !is.na(label)) |> \n  select(symbol, contains(\"ratio\")) |> \n  pivot_longer(-symbol) |> \n  mutate(name = str_to_title(str_replace_all(name, \"_\", \" \"))) |> \n  ggplot(aes(x = value, y = name, fill = symbol)) +\n  geom_col(position = \"dodge\") +\n  scale_x_continuous(labels = percent) + \n  labs(\n    x = NULL, y = NULL, fill = NULL,\n    title = \"Liquidity ratios for selected stocks from the Dow index for 2023\"\n  )\nfig_liquidity_ratios\n```\n\n::: {.cell-output-display}\n![Liquidity ratios are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-409-1.png){#fig-409 fig-alt='Title: Liquidity ratios for selected stocks for 2023. The figure shows a bar chart liquidity ratios on the vertical and corresponding values on the horizontal axis.' width=2100}\n:::\n:::\n\n\n\n\n## Leverage Ratios\n\nThe debt-to-equity ratio measures the proportion of debt financing relative to equity financing. A higher ratio indicates more leverage and potentially higher financial risk. \n\n$$\\text{Debt-to-Equity} = \\frac{\\text{Total Debt}}{\\text{Total Equity}}$$\n\nThe debt-to-asset ratio indicates the percentage of a company’s assets that are financed by debt. A higher ratio also suggests more leverage. \n\n$$\\text{Debt-to-Asset} = \\frac{\\text{Total Debt}}{\\text{Total Assets}}$$\n\nInterest Coverage assesses a company’s ability to pay interest on its debt. Here, a higher ratio indicates better capability to meet interest obligations, and hence less financial risk. \n\n$$\\text{Interest Coverage} = \\frac{\\text{EBIT}}{\\text{Interest Expense}}$$\n\nWe can easily calculate these ratios using our balance sheet and income statements data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbalance_sheets_statements <- balance_sheets_statements |> \n  mutate(\n    debt_to_equity = total_debt / total_equity,\n    debt_to_asset = total_debt / total_assets\n  )\n\nincome_statements <- income_statements |> \n  mutate(\n    interest_coverage = operating_income / interest_expense,\n    label = if_else(symbol %in% selected_symbols, symbol, NA),\n  )\n```\n:::\n\n\n\n\n@fig-410 shows the debt-to-assets over time.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_debt_to_asset <- balance_sheets_statements |> \n  filter(symbol %in% selected_symbols) |> \n  ggplot(aes(x = calendar_year, y = debt_to_asset,\n             color = symbol)) +\n  geom_line(linewidth = 1) +\n  scale_y_continuous(labels = percent) +\n  labs(x = NULL, y = NULL, color = NULL,\n       title = \"Debt-to-asset ratios of selected stocks between 2020 and 2024\") \nfig_debt_to_asset\n```\n\n::: {.cell-output-display}\n![Debt-to-asset ratios are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-410-1.png){#fig-410 fig-alt='Title: Debt-to-asset ratios of selected stocks between 2020 and 2024. The figure shows a line chart with years on the horizontal axis and debt-to-asset ratios on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n@fig-411 shows debt-to-asset ratio in the cross-section\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselected_colors <- c(\"#F21A00\", \"#EBCC2A\", \"#3B9AB2\", \"lightgrey\")\n\nfig_debt_to_asset_cross_section <-  balance_sheets_statements |> \n  filter(calendar_year == 2023) |> \n  ggplot(aes(x = debt_to_asset,\n             y = fct_reorder(symbol, debt_to_asset),\n             fill = label)) +\n  geom_col() +\n  scale_x_continuous(labels = percent) +\n  scale_fill_manual(values = selected_colors) +\n  labs(x = NULL, y = NULL, color = NULL,\n       title = \"Debt-to-asset ratios of Dow index constituents in 2023\") + \n  theme(legend.position = \"none\")\nfig_debt_to_asset_cross_section\n```\n\n::: {.cell-output-display}\n![Debt-to-asset ratios are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-411-1.png){#fig-411 fig-alt='Title: Debt-to-asset ratios of Dow index constituents in 2023. The figure shows a bar chart with debt-to-asset ratios on the horizontal and corresponding symbols on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n@fig-412 shows debt-to-asset vs interest coverage\n \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_debt_to_asset_interest_coverage <- income_statements |> \n  filter(calendar_year == 2023) |> \n  select(symbol, interest_coverage, calendar_year) |> \n  left_join(\n    balance_sheets_statements,\n    join_by(symbol, calendar_year)\n  ) |> \n  ggplot(aes(x = debt_to_asset, y = interest_coverage, color = label)) +\n  geom_point(size = 2) +\n  geom_label_repel(aes(label = label), seed = 42, box.padding = 0.75) +\n  scale_x_continuous(labels = percent) +\n  scale_y_continuous(labels = percent) +\n  scale_color_manual(values = selected_colors) +\n  labs(\n    x = \"Debt-to-Asset\", y = \"Interest Coverage\",\n    title = \"Debt-to-asset ratios and interest coverages for Dow index constituents\"\n  ) +\n  theme(legend.position = \"none\")\nfig_debt_to_asset_interest_coverage\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 27 rows containing missing values\n(`geom_label_repel()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Debt-to-asset ratios and interest coverages are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-412-1.png){#fig-412 fig-alt='Title: Debt-to-asset ratios and interest coverages for Dow index constituents. The figure shows a scatter plot with debt-to-asset on the horizontal and interest coverage on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n## Efficiency Ratios\n\nAsset Turnover measures how efficiently a company uses its assets to generate revenue. A higher ratio indicates more efficient use of assets. \n\n$$\\text{Asset Turnover} = \\frac{\\text{Revenue}}{\\text{Total Assets}}$$\n\nInventory turnover indicates how many times a company’s inventory is sold and replaced over a period. The higher the ratio, the more efficient is the inventory management. \n\n$$\\text{Inventory Turnover} = \\frac{\\text{COGS}}{\\text{Inventory}}$$\n\nReceivables turnover measures how effectively a company collects receivables. A higher ratio indicates a more efficient credit and collection processes. \n\n$$\\text{Receivables Turnover} = \\frac{\\text{Revenue}}{\\text{Accounts Receivable}}$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_statements <- balance_sheets_statements |> \n  select(symbol, calendar_year, label, current_ratio, quick_ratio, cash_ratio,\n         debt_to_equity, debt_to_asset, total_assets, total_equity) |> \n  left_join(\n    income_statements |> \n      select(symbol, calendar_year, interest_coverage, revenue, cost_of_revenue,\n             selling_general_and_administrative_expenses, interest_expense,\n             gross_profit, net_income),\n    join_by(symbol, calendar_year)\n  ) |> \n  left_join(\n    cash_flow_statements |> \n      select(symbol, calendar_year, inventory, accounts_receivables),\n     join_by(symbol, calendar_year)\n  )\n\ncombined_statements <- combined_statements |> \n  mutate(\n    asset_turnover = revenue / total_assets,\n    inventory_turnover = cost_of_revenue / inventory,\n    receivables_turnover = revenue / accounts_receivables\n  )\n```\n:::\n\n\n\n\n## Profitability Ratios\n\nGross margin shows the percentage of revenue that exceeds the cost of goods sold (COGS). A higher gross margin implies that the company retains a higher percentage of revenue as gross profit. \n\n$$\\text{Gross Margin} = \\frac{\\text{Gross Profit}}{\\text{Revenue}}$$\n\nProfit margin is the percentage of revenue that translates into net income. A higher profit margin suggests a more profitable company. \n\n$$\\text{Profit Margin} = \\frac{\\text{Net Income}}{\\text{Revenue}}$$\n\nAfter-tax ROE measures the return on shareholders' equity after accounting for taxes. A higher ROE indicates that the company is effectively generating profit from shareholders' investments. \n\n$$\\text{After-Tax ROE} = \\frac{\\text{Net Income}}{\\text{Total Equity}}$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_statements <- combined_statements |> \n  mutate(\n    gross_margin = gross_profit / revenue,\n    profit_margin = net_income / revenue,\n    after_tax_roe = net_income / total_equity\n  )\n```\n:::\n\n\n\n\nGross margin over time @fig-413 shows\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_gross_margin <- combined_statements |> \n  filter(symbol %in% selected_symbols) |> \n  ggplot(aes(x = calendar_year, y = gross_margin, color = symbol)) +\n  geom_line() +\n  scale_y_continuous(labels = percent) + \n  labs(x = NULL, y = NULL, color = NULL,\n       title = \"Gross margins for selected stocks between 2019 and 2023\")\nfig_gross_margin\n```\n\n::: {.cell-output-display}\n![Gross margins are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-413-1.png){#fig-413 fig-alt='Title: Gross margins for selected stocks between 2019 and 2023. The figure shows a line chart with years on the horizontal axis and gross margins on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\nProfit margin vs gross margin @fig-414 shows\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_gross_margin_profit_margin <- combined_statements |> \n  filter(calendar_year == 2023) |> \n  ggplot(aes(x = gross_margin, y = profit_margin, color = label)) +\n  geom_point(size = 2) +\n  geom_label_repel(aes(label = label), seed = 42, box.padding = 0.75) +\n  scale_x_continuous(labels = percent) +\n  scale_y_continuous(labels = percent) + \n  scale_color_manual(values = selected_colors) + \n  labs(\n    x = \"Gross margin\", y = \"Profit margin\",\n    title = \"Gross and profit margins for Dow index constituents for 2023\"\n  )  +\n  theme(legend.position = \"none\")\nfig_gross_margin_profit_margin\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 27 rows containing missing values\n(`geom_label_repel()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Gross and profit margins are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-414-1.png){#fig-414 fig-alt='Title: Gross and profit margins for Dow index constituents for 2023. The figure shows a scatter plot with gross margins on the horizontal and profit margins on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n## Combining Financial Ratios\n\nRanking companies in different categories\n\n@fig-415 shows\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinancial_ratios <- combined_statements |> \n  filter(calendar_year == 2023) |> \n  select(symbol, \n         contains(c(\"ratio\", \"margin\", \"roe\", \"_to_\", \"turnover\", \"interest_coverage\"))) |> \n  pivot_longer(cols = -symbol) |> \n  mutate(\n    type = case_when(\n      name %in% c(\"current_ratio\", \"quick_ratio\", \"cash_ratio\") ~ \"Liquidity Ratios\",\n      name %in% c(\"debt_to_equity\", \"debt_to_asset\", \"interest_coverage\") ~ \"Leverage Ratios\",\n      name %in% c(\"asset_turnover\", \"inventory_turnover\", \"receivables_turnover\") ~ \"Efficiency Ratios\",\n      name %in% c(\"gross_margin\", \"profit_margin\", \"after_tax_roe\") ~ \"Profitability Ratios\"\n    )\n  ) \n\nfig_ranks <- financial_ratios |> \n  group_by(type, name) |> \n  arrange(desc(value)) |> \n  mutate(rank = row_number()) |> \n  group_by(symbol, type) |> \n  summarize(rank = mean(rank), \n            .groups = \"drop\") |> \n  filter(symbol %in% selected_symbols) |> \n  ggplot(aes(x = rank, y = type, color = symbol)) +\n  geom_point(shape = 17, size = 4) +\n  scale_color_manual(values = selected_colors) + \n  labs(x = \"Average rank\", y = NULL, color = NULL,\n       title = \"Average rank among Dow index constituents for selected stocks\") +\n  coord_cartesian(xlim = c(1, 30))\nfig_ranks\n```\n\n::: {.cell-output-display}\n![Ranks are based on financial statements as provided through the FMP API.](financial-ratios_files/figure-html/fig-415-1.png){#fig-415 fig-alt='Title: Rank in financial ratio categories for selected stocks from the Dow index. The figure shows a scatter plot with ranks for selected stocks on the horizontal and categories of financial ratios on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n## Financial Ratios in Asset Pricing\n\nThe Fama-French five-factor model aims to explain stock returns by incorporating specific financial metrics ratios. We provide more details in [Replicating Fama-French Factors](replicating-fama-and-french-factors.qmd), but here is an intuitive overview:\n\n-  Size: Calculated as the logarithm of a company’s market capitalization, which is the total market value of its outstanding shares. This factor captures the tendency for smaller firms to outperform larger ones over time.\n- Book-to-Market Ratio: Determined by dividing the company’s book equity by its market capitalization. A higher ratio indicates a 'value' stock, while a lower ratio suggests a 'growth'’' stock. This metric helps differentiate between undervalued and overvalued companies.\n- Profitability: Measured as the ratio of operating profit to book equity, where operating profit is calculated as revenue minus cost of goods sold (COGS), selling, general, and administrative expenses (SG&A), and interest expense. This factor assesses a company’s efficiency in generating profits from its equity base.\n- Investment: Calculated as the percentage change in total assets from the previous period. This factor reflects the company’s growth strategy, indicating whether it is investing aggressively or conservatively.\n\nWe can calculate these factors using the FMP API as follows:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmarket_cap <- constituents |> \n  map_df(\n    \\(x) fmp_get(\n      resource = \"historical-market-capitalization\", \n      x, \n      list(from = \"2023-12-29\", to = \"2023-12-29\")\n    )\n  ) \n\ncombined_statements_ff <- combined_statements |> \n  filter(calendar_year == 2023) |> \n  left_join(market_cap, join_by(symbol)) |> \n  left_join(\n    balance_sheets_statements |> \n      filter(calendar_year == 2022) |> \n      select(symbol, total_assets_lag = total_assets), \n    join_by(symbol)\n  ) |> \n  mutate(\n    size = log(market_cap),\n    book_to_market = market_cap / total_equity,\n    operating_profitability = (revenue - cost_of_revenue - selling_general_and_administrative_expenses - interest_expense) / total_equity,\n    investment = total_assets / total_assets_lag\n  )\n```\n:::\n\n\n\n\n@fig-416 shows the ranks of our selected stocks for the Fama-French factors. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig_rank_ff <- combined_statements_ff |> \n  select(symbol, Size = size, \n         `Book-to-Market` = book_to_market, \n         `Profitability` = operating_profitability,\n         Investment = investment) |> \n  pivot_longer(-symbol) |> \n  group_by(name) |> \n  arrange(desc(value)) |> \n  mutate(rank = row_number()) |> \n  ungroup() |> \n  filter(symbol %in% selected_symbols) |> \n  ggplot(aes(x = rank, y = name, color = symbol)) +\n  geom_point(shape = 17, size = 4) +\n  scale_color_manual(values = selected_colors) + \n  labs(\n    x = \"Rank\", y = NULL, color = NULL,\n    title = \"Rank in Fama-French variables for selected stocks from the Dow index\"\n  ) +\n  coord_cartesian(xlim = c(1, 30))\nfig_rank_ff\n```\n\n::: {.cell-output-display}\n![Ranks are based on financial statements and historical market capitalization as provided through the FMP API.](financial-ratios_files/figure-html/fig-416-1.png){#fig-416 fig-alt='Title: Rank in Fama-French variables for selected stocks from the Dow index. The figure shows a scatter plot with ranks for selected stocks on the horizontal and Fama-French variables on the vertical axis.' width=2100}\n:::\n:::\n\n\n\n\n## Key Takeaways\n\n- Financial statements provide standardized, legally required insights into a company’s financial position\n- Ratios allow benchmarking & trend analysis across liquidity, leverage, efficiency & profitability dimensions\n- `fmpapi` enables easy access to financial data for ratio calculations & peer comparisons\n\n## Exercises\n\n1. ...\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}